using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace _19_1
{
	class Program
	{
		const string Map =
@"                                                                                                                                                         |                                               
                                                 +-------------------------------------------------------------------------------------------------------------------------------------------+           
                                                 |                                                                                                       |                                   |           
 +---------+                                     |         +---------------+         +-------------+           +---+   +-----------------------------------------------------------------+   |           
 |         |                                     |         |               |         |             |           |   |   |                                 |                               |   |           
 |         |         +---------------+       +---|-------------------------|---------|---+         |           +-----------------------------------------|-------------------------------|-------------+ 
 |         |         |               |       |   |         |               |         |   |         |               |   |                                 |                               |   |         | 
 +-------------------------------------------|---|-------------------------|-------------|-------------------------|---|---------------------------+     |             +---+ +-------------------+ +-+ | 
           |         |               |       |   |         |               |         |   |         |               |   |                           |     |             |   | |           |   |   | | | | 
 +---------|---------+               |       +-----------------------------|---------|---|---------|---------------|------D--------------------------------------------------|-------------------+ | | | 
 |         |                         |           |         |               |         |   |         |               |   |                           |     |             |   | |           |   |     | | | 
 |   +-------------------------------------------|-------+ |               |         |   |       +-|-----+     +---------------------------------+ | +---|-------------|-------------------+ |     | | | 
 |   |     |                         |           |       | |               |         |   |       | |     |     |   |   |                         | | |   |             |   | |           | | |     | | | 
 |   |     |                       +---------+   |       | |               |         |   |       | |     |     |   |   |           +-------------|---|---|-------------+   | |           | | |     | | | 
 |   |     |                       | |       |   |       | |               |         |   |       | |     |     |   |   |           |             | | |   |                 | |           | | |     | | | 
 | +-------------------+           | | +-----------------|-|-------------------------|---|-------------+ | +-+ +---|-----------------+   +-------|----R--|-----------------------+ +-+   | | +-+   | | | 
 | | |     |           |           | | |     |   |       | |               |         |   |       | |   | | | |     |   |           | |   |       | | |   |                 | |   | | |   | |   |   | | | 
 | | |     |           |           | | |     |   |       | |     +-+ +-------------------|---------|---|-----------|---------------|-|---|---------|-|---|-------------+   | |   | | |   | |   |   | | | 
 | | |     |           |           | | |     |   |       | |     | | |     |         |   |       | |   | | | |     |   |           | |   |       | | |   |             |   | |   | | |   | |   |   | | | 
 | | |     |         +-|-------------------------|---------|---------|---------+     |   |       | |   | | | |     |   |           +-----|-------+ | |   |             |   | |   | +-|---|-+   |   | | | 
 | | |     |         | |           | | |     |   |       | |     | | |     |   |     |   |       | |   | | | |     |   |             |   |         | |   |             |   | |   |   |   |     |   | | | 
 | | |     |         | |           | +-----------|---------+     | | |     | +-|-----|---|-------|-----|-----|-----------------------|---+     +---------|-------------|-------------|---|-------------+ 
 | | |     |         | |           |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |         |   | |   |             |   | |   |   |   |     |   | |   
 | +-|-----------------------------|---------|---|-------|-----------------|-|-|-----|-----------|---------------------------------------------+   | |   |             |   | |   |   |   |     |   | |   
 |   |     |         | |           |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |             | |   |             |   | |   |   |   |     |   | |   
 |   |     |         | |     +-+   |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |       +-----|-|---|-------+     |   | |   +-------|-------+ | |   
 |   |     |         | |     | |   |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |       |     | |   |       |     |   | |       |   |     | | | |   
 |   |     |         | |     | +-------|-----|-----------|-----------|---+ | | |     |   |       | |   | | | +-----|---|-+ +---------|-------|-------|---|-------|-----|---+ |       |   |     | | | |   
 |   |     |         | |     |     |   |     |   |       |       | | |   | | | |     |   |       | |   | | |       |   | | |         |       |     | |   |       |     |     |       |   |     | | | |   
 | +-------------------|-----|---------|-----|---|---------------|-|-------|-|-------|-----------+ | +---|-|---+   |   | +---+       |       +-----------|-------|-----------|-------|---------|-+ | |   
 | | |     |         | |     |     |   |     |   |       |       | | |   | | | |     |   |         | | | | |   |   |   |   | |       |             | |   |       |     |     |       |   |     |   | |   
 | | |     |         | |     |     |   | +-------|-------------------------|---|---------+         | | | | |   |   |   |   | |       |       +-----|-|-----------+   +---------------+   |     |   | |   
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |   |   | |       |       |     | |   |           | |     |           |     |   | |   
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |   +---|-|-------|-------|-----|-----|-------+   | |     |           | +---|---|-|-+ 
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |       | |       |       |     | |   |       |   | |     |           | |   |   | | | 
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   | +---------|-|---------------|-----|-----|---+   |   | |     |           | |   |   | | | 
 | | |     |         S |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   | | |       | |       |       |     | |   |   |   |   | |     |           | |   |   | | | 
 | | |     |   +-------|-----|--------F|-|---|---|---------------------+ | | | |     |             | | | | |   | | |       | +-----------+   +-+ +-|-|---|---|-------|-----------------+ | |   |   | | | 
 | | |     |   |     | |     |     |   | |   |   |       |       | | | | | | | |     |             | | | | |   | | |       |         |   |     | | | |   |   |   |   | |     |         | | |   |   | | | 
 | | |     |   |     | |     |     |   | |   |   |       |       | | | | | | +-|-----+         +---|-----------+ | |     +---------------|---------------|---|-----+ +-|---------+     | | |   |   | | | 
 | | |     |   |     | |     |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |     | | | |   |   |   | |   |     |   |     | | |   |   | | | 
 | | |     | +---+   | +-----|-----|---------------------|-------|-|---|-----------------------|-------|-|-------|-------|-----------|---|---------|-----|-------|-|-+ |     |   |     | | |   |   | | | 
 | | |     | | | |   |       |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |     | | | |   |   |   | | | |     |   |     | | |   |   | | | 
 +-|---+   | | | +---------------------------|-------------------------|-|---------------------|---------|---------------|-----------|-------+ | | | |   |   |   | | | |     |   |     | | |   |   | | | 
   | | |   | | |     |       |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |   | | | | |   |   |   | | | |     |   |     | | |   |   | | | 
   | | |   | | |     |       |     |   | |   |   |       |   +---|---|-|-|-----|-------------------|---|---|-------------|-----------------------|-|-|-+ |   |   | | | |     |   |     | | |   |   | | | 
   | | |   | | |     |       |     |   | |   |   |       |   |   | | | | | |   |               |   | | | | |     | |     | |         |   |   | | | | | | |   |   | | | |     |   |     | | |   |   | | | 
   | | |   | | |     |       |     |   | |   |   |       +---|---|-|---|-|---+ |               |   | | | | +-----|-|-----|---+ +-----|---+   | | | | | | |   |   | | | |     |   |   +-|-|-+   |   | | | 
   | | |   | | |     |       |     |   | |   |   |           |   | | | | | | | |               |   | | | |       | |     | | | |     |       | | | | | | |   |   | | | |     |   |   | | |     |   | | | 
   | | |   | | |     |       |     |   | |   |   |           |   | | | +-|-|-|-|-------------------|-|-------------|---+ | | | |     |       | | | | | | |   |   | | | |     |   |   | | | +---|-+ | | | 
   | | |   | | |     |       |     |   | |   |   |           |   | | |   | | | |               |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   | | | |   | | | | | 
   | | +-----|-+     |   +---------|-----|---|---------------|-----|---------|-----------------|---|-|-|-----------|-------|---|-----|-------|-|-|---|-|---------|-|---|---------|---|-----+   | | | | | 
   | |     | |       |   |   |     |   | |   |   |           |   | | |   | | | |               |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   | | |     | | | | | 
 +---|---+ | |       |   |   |     |   | |   +---------+     |   | | |   | | | |             +-|---|---|---------|-------|-|-|-|-----|-------------|---|-----|-----|---|-------------|-+ |     | | | | | 
 | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   |   |     | | | | | 
 | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | | +-----|---+     |       | | +-|-|---|---|---|-----|-----|---|-------|---+ | | | | | 
 | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | | | | | | |       |       | |   | | | |   |   | | | |     |   |   |   |   | | | | | | 
 | | |   | +-|-------|---|-+ |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   +-----|-|-|---|-|-------|-------|-----|-|-+ |   |   | | | |     |   |   |   |   | | | | | | 
 | | |   |   |       |   | | |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   |   | | | | | | |       |       | |   | |   |   |   | | | |     |   |   |   |   | | | | | | 
 | | | +-------+ +---|---|-|-----------|-|-------|-----|-----|---|-|-----|-----|-------------|-----|-----------------|---+ | |       |       | +---|-+ +-----|-------|-----------|---+   |   | | | | | | 
 | | | | |   | | |   |   | | |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | | | |     |   |       |   | | | | | | 
 | | | | |   | | |   |   | | |     |   | |       |     |     | +-|-+ |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | | +-------|-+ |       |   | | | | | | 
 | | | | |   | | |   |   | | |     |   | |       |     |     | | |   |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | |   |     | | |       |   | | | | | | 
 | | | +-|-----|-------------|---------|---------|-----------|-----------------|-------------|-|---|-------+ |   | | | |   | |       |   +-------+ |   | |   |   | |   +-----|-|-|-----------|---|-|---+ 
 | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |   | | | |             | |   | | | | | |   | | | |   | |       |   |   |   | |   | |   |   | |         | | |       |   | | | | |   
 | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |   +-|-|-|---------------------|-----|-|-----|-|-------------------|---|-+ | |   | |   |   | |         | | |       |   | | | | |   
 | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   |   | | | |   | |   |   | |         | | |       |   | | | | |   
 | | |   +---|-|-|---------------+ | +-+ |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | +-+ | +-------|-------------------|---|-------|---------+ |   
 | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |   
 | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |   
 | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |   
 | | |     +-----|---|-----|-|---|-|-----|---------+   |     | | |   |     | | |         +-----|-------+ | +-----|---|-------|-------|-----|-----------------|---|-|---------|-|-|-+     |   | | |   |   
 | | |     | | | |   |   | | |   | | |   |       | |   |     | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   | |         | | | |     |   | | |   |   
 | | |     | | | |   |   | | |   | | |   |       | |   +---------------------|-----------------|-----------------|-|-|-|---|-|-------------|-----------------|-----+         | | | |     |   | | |   |   
 | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |   | | |   |   
 | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |   +-------|-+ 
 | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |     | |   | | 
 | | | +---|-----|---|-----------|-|-|-------------|-----+   +---|-+ |     | | |         |   | |   | |   |   |   | +---------|-----+ |   | |   |   |   | |   |   |           | | | |     |     | |   | | 
 | | | |   | | | |   |   | | |   | | |   |       | |     |     | | | |     | | |         |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |           | | | |     |     | |   | | 
 | | | | +-+ +---|---------+ |   | | +---|-------|-|-----|---------|-|-----|-------------------|---|-|---|---------------------------|---|-|-------------|-------|-----------+ | | |   +---------+ +---+ 
 | | | | |     | |   |   |   |   | |     |       | |     |     | | | |     | | |         |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |             | | |   | |     |   | |   
 | | | | +-+   | |   |   +---|-----|-----+       | |     +-------|-|-|-----|-|-|-------+ |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |             +-|-|---|-------------|-+ 
 | | | |   |   | |   |       |   X |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |               | |   | |     |   | | | 
 | | | +---|-+ | |   |       |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   +---|-----------------+   | |     |   | | | 
 | | |     | | | |   |       |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |       |               |     | |     |   | | | 
 | | |     | | | |   |   +-------|---------------|-|-------------|-|---------|-----------|---|-----|-----|-----------+ |   | |     +-|-----|---+   |   | +-------|-------+ +-----|-----+ |     |   | | | 
 | | |     | | | |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |       |   | |       |   |         |       | |     |       |     |   | | | 
 | | |   +---|---|-----------|---|-|-------------|---------------|-|---------------------|-----|---|-----|---|---|-----|-----------+ |   | |       |   |         |     +-|---------------------|-+ | | | 
 | | |   | | | | |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | | 
 +-|-|-----|---+ |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | | 
   | |   | | |   |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | | 
   | |   | | |   |   |   |   |   | | +-------------|-----------------|---------|-------|-----|-----|-|---|---|---+     |   | |     +-----|---------|-------------|-----|---|-----|-------|-----|-+ | | | 
   | |   | | |   |   |   |   |   | | |           | |           | | | |     | | |       | |   | |   | |   |   |         |   | |       |   | |       |   |         |     | | |     |       |     |   | | | 
 +-|-|---|-|-|-------|-----------|---|---+       | |           | | +---------|---------|-|---------------|-------------|---|-+       |   | |       | +-|---------|-------|-------------+ |     |   | | | 
 | | |   | | |   |   |   |   |   | | |   |       | |           | |   |     | | |       | |   N |   | |   |   |         |   |         |   | |       | | |         |     | | |     |     | |     |   | | | 
 | | |   +-|-|-----------|---|---|-|---------------|-------------|-----+   | | |       | |   | |   | |   |   |         |   |       +-------------+ | | |         |     | | |     | +---|-|-----+   | | | 
 | | |     | |   |   |   |   |   | | |   |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       | |   | |     | | | |         |     | | |     | |   | |         | | | 
 | | +-+   | |   +---|-------|-----|-+   |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       | +-------------|---|---------|-----|---------|-----|-----------+ | | 
 | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | | 
 | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | | 
 | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | | 
 | |   |   | |       |   |   | +---|---------------|-----------------|-|-------|-------|-----------|-|---|---|---------------------------|-------|-----+         |     | | |     | |   | |   +-----+ | | 
 | |   |   | |       |   |   | | | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | | 
 | |   |   | | +-------------|-------------------|-|---+       | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | |     |       | |   |       | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | | +-+ |       | |   | +-------|-----|---|-|----------------P----|-----|---|---------|---|-------------|-|---------|-----------|-----|-|-|-+   | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | | |   | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | | | +---------|-------|-----|-----|---------|---------------|---------|-------------|-----------|-----|-|-------|---------+   |     | | | |   | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | | |   |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | | | +-|---------------|-----|-------|---|-----------|-------|-----|-------|---------+   |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | | 
 | |   |   | | |     |   |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | | 
 | |   |   | | |     +-------------|-------------|-------|-----|-----------|-|-|-------|---------------------|-------------|-----------------------|---------|---+     | | +-------|---|-----+   +-+ | | 
 | |   |   | | |         |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       |     | |     | | |       |         | |   |   | |   | |       |   | | 
 | |   |   | | |       +-------|-|-|-|-|-------+ | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       | +-----|-----|-----------------+   | |   |   +-|-+ | |       | +---+ 
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       | |   | |     | | |       |     |   | |   |     | | | |       | | |   
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |   +---|-----+ | |   | |   | |   |   |             |       | |   | |     | | |   +---|---------|-|---+     | | | |       | | +-+ 
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |   | |   | |   |   |             |       | |   | |     | | |   |   |     |   | |         | | | |       | |   | 
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |   +-|-+ +---------|---------+   |       | |   | | +-------|-------------|---|-|---------|-------------+ |   | 
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |     | |   |   |   |         |   |       | |   | | |   | | |   |   |     |   | |         | | | |         |   | 
 | | +-------|-|---------|---|-----|---|-|-----|-|-------|-----|-------|-------|-------|-|-------|---------------------|---|---------|---|-|-----|-|-|---|---|-------+ | |         | | | |     +---+   | 
 | | | |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |     | |   |   |   |         |   |       | |   | | |   | | |   |   |     | | | |         | | | |     |       | 
 | | | |   | | |       | |   | | | | | | |   +-+ | |   | |   +---------|-------------|---------|-----|---|-----------------+       | |   | | |   | | |   |   |     | +-|---+       | | | |     |       | 
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   |   |         |           | |   | | |   | | |   |   |     |   | | |       | | | |     |       | 
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   | +-|---------------------|---------|---|---|---|-------------|-----------|---|-|-----|---+   | 
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   | | |         |           | |   | | |   | | |   |   |     |   | | |       | | | |     |   |   | 
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   +-----|-|---------------------|-|---|-|-|-----|-----|---+     |   | | |       | | | |     |   |   | 
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |       | | |         |           | |   | | |   | | |   |         |   | | |       | | | |     |   |   | 
 | | | |   | | |       | |   | | | | | | |   |   | +---------|-------|-------|-|---------------|-|---------|-|---------|-----------|-|-----------|---|-----+       |   | | |       | | | |     |   |   | 
 | | | |   | | |       | |   | | | | | | |   |   |     | |   | | |   | |     | |     | | |     | |       | | |         |           | |   | | |   | | |   | |       |   | | |       | | | |     |   |   | 
 | | | |   | | |       | +---|-|---|-----|---|-----------|---+ | |   | |     | |     | | |     | |       | | |         +-----------|-------|-----|-|-----------------------------------|-|-----|---|-+ | 
 | | | |   | | |       |     | | | | | | |   |   |     | |     | |   | |     | |     | | |     | |       | | |                     | |   | | |   | | |   | |       |   | | |       | | | |     |   | | | 
 | | | | +-----------------------|-----|-|---+   |     | |     | |   | |     | |     | | |     | |       | | +---------------------|-------|-|-----|-|---|---------|---|-----------|-|-|-----------|-+ | 
 | | | | | | | |       |     | | | | | | |       |     | |     | |   | |     | |     | | |     | |       | |                       | |   | | |   | | |   | |       |   | | |       | | | |     |   |   | 
 | | +---+ | | |       |     | | | | | +-----------------|-----|-----|---------------|---------------------------------------------|-----|---------|-|-------------------|---------|-----|-----|-----+ | 
 | |   |   | | |       |     | | | | |   |       |     | |     | |   | |     | |     | | |     | |       | |                       | |   | | |   | | |   | |       |   | | |       | | | |     |   | | | 
 | |   |   | | |       |     | | | | |   |       |     | | +-+ +-----|-------|---------|-----+ | |       | |                       | |   | | |   | | |   | |       | +-|-|-------+ | | | |     |   | | | 
 | |   |   | | |       |     | | | | |   |       |     | | | |   |   | |     | |     | | |   | | |       | |                       | |   | | |   | | |   | |       | | | | |     | | | | |     |   | | | 
 +-|-----------|-------|-----+ +---+ |   |   +-------------|---------|-------|-------|-|--------------J--|-+                       +-+   | | |   | | |   | |       | | | | |     | | | | |     |   | | | 
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |   | | |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | | 
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |   +-+ |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | | 
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |       |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | | 
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     +-|---------|---------------------------------------|-|---------|---|-|-------|-+ | | |     | | | | |     |   | | | 
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |       | |       |       |                               | | |   | | |   | |       |   | | |     | | | | |     |   | | | 
 +-|-+ |   | | |     +-|---------|-+ |   +-----------------|-|---|---|-|-----|-|-------|-|---------------|---+                           | +-+   | | |   | |       |   | | |   +-|-------|-----|---+ | | 
 | | | |   | | |     | |         | | |       |   |     | | | |   |   | |     | |       | |       |       |   |                           |       | | |   | |       |   | | |   | | | | | |     |     | | 
 | | | | +-|-|-------------------|-|---------------------+ | |   |   +---------|-----------------------------|---------------------------|---------|-|---+ |       |   | | |   | | | +-|-------|-+   | | 
 | | | | | | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       |   |                           |       | | |     |       |   | | |   | | |   | |     | |   | | 
 | +-|---+ | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       | +-|---------------------------|---------|-|-------------|-----|-------|-|---|---------|-+ | | 
 |   | |   | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |       |   | | |   | | |   | |     | | | | | 
 |   | |   | | |     | +---------|-|-|---------------------------------|-----|-|-------|---------|---------|-|---------------------------|---------|-------------+ |   | | +-------|---|-------|-|-+ | | 
 |   | |   | | |     |           | | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     | |   | | 
 +-+ | |   | | |     |   +-------+ | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     | +-+ | | 
   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | | 
   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | | 
   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | | 
   | | |   | | |     |   |   +-------|-------|---|---------------|-----------------------|---------------|-----------------------------------------|-+     |     +-|---+ |     | | |   | +-------+ | | | 
   | | |   | | |     |   |   |     | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | | 
   | | |   | | |     |   |   | +---|-|-----------|-----|-------+ |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | | 
   | | |   | | |     |   |   | |   | |       |   |     |   | | | |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | | 
   | | |   | | |     |   |   +-|-------------|---------------|---------|---------------------------------|-|-------------------------------------|-|---------------------------|-|---+ |       | | | | | 
   | | |   | | |     |   |     |   | |       |   |     |   | | | |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | |       | | | | | 
 +-----------|-|-----------------------------|---|---+ |   | | | +-----------|---------------------------|-|-----------------------------|-----------------|-------------|-----|---|-|---+     | | | | | 
 | | | |   | | |     |   |     |   | |       |   |   | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | | 
 | | | |   | | |     |   |   +-----|-------------+   | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | | 
 | | | |   | | |     |   |   | |   | |       |       | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | | 
 | | | +---|-+ +-----|---------|---+ |       |       | +-----|-|-------|-------|-----------------|---------------+                       |       | |       |       |     +-----|-|-+ | | | +-+ | | | | | 
 | | |     |         |   |   | |     |       |       |     | | |       |     | |       | |       |       | | |   |                       |       | |       |       |           | |   | | | | | | | | | | 
 | | | L---|---+     |   |   | |     |     +-----------------|---------------|---------|---------|-------|---|---|-----------------------|-------|---------|-------|---------------------|-+ | | | | | | 
 | | |     |   |     |   |   | |     |     | |       |     | | |       |     | |       | |       |       | | |   |                       |       | |       |       |           | |   | | |   | | | | | | 
 +-|---+   |   |     |   |   | |     |     | |       |     | | |       |     | |       +-|---------------|---|---|-----------------------|-------|-----------------------------------|-+ |   | | | | | | 
   | | |   |   |     |   |   | |     |     | |       |     | | |       |     | |         |       |       | | |   |                       |       | |       |       |           | |   |   |   | | | | | | 
   | | |   |   |     +---|-----|-----+     | |       |     | | |       |     | |         |       |       | | |   +-------------------------------|---------|-------|-----------+ +---------+ | | | | | | 
   | | |   |   |         |   | |           | |       |     | | |       |     | |         |       |       | | |                           |       | |       |       |                 |   | | | | | | | | 
   | | +---|-----------------|-|-----------|-|---+   |     | | |       +-----|-|-----------------|---------|-|---------------------------|---------|-------+       |                 |   | | | | | | | | 
   | |     |   |         |   | |           | |   |   |     | | |             | |         |       |       | | |                           |       | |               |                 |   | | | | | | | | 
   +-|---------+         |   | +-----------|-----+   |     | | |             | |         |       |       | | |                 +-----------------|-|---------------|-----------------+   +-+ +-|-|-+ | | 
     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | | 
     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | | 
     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | | 
     |     |             |   |             | |       |     | | |             +-------------------|-------|Z--+                 |         |       | +---------------------------------------+   | |   | | 
     |     |             |   |             | |       |     | | |               |         |       |       | |                   |         |       |                 |                       |   | |   | | 
     |     |             |   |             | |       |     | +-----------------|---------|-------+       | |                   |         |       |                 +-------------------------+ | |   | | 
     |     |             |   |             | |       |     |   |               |         |               | |                   |         |       |                                         | | | |   | | 
     |     |             |   +-------------|---------|-----|---|---------------+ +---------------------------------------------|-----------------|-------------------------------------------|-|-|-----+ 
     |     |             |                 | |       |     |   |                 |       |               | |                   |         |       |                                         | | | |   |   
     +-----|-------------|-----------------|-|-------+     |   |                 |       |               | |                   |         |       |                                         | | | |   |   
           |             |                 | |             |   |                 |       |               | |                   |         |       |                                         | | | |   |   
           |             +-----------------|---------------|---------------------+       |               | |                   |         |       |                                         | +---|-----+ 
           |                               | |             |   |                         |               | |                   |         |       |                                         |   | |   | | 
           |                   +---------------------------|---|-------------------------|-----------------|-------------------|---------+       |           +-----------------------------+   | |   | | 
           |                   |           | |             |   |                         |               | |                   |                 |           |                                 | |   | | 
           |                   |           | |             |   |                         |               | +-------+           |                 +-----------|-----------------------------------+   | | 
           |                   |           | |             |   |                         |               |         |           |                             |                                 |     | | 
           |                   |           | |             |   |                         |               +---------|-----------------------------------------|---------------------------------+   +-+ | 
           |                   |           | |             |   |                         |                         |           |                             |                                     |   | 
           |                   +-------------|-------------|---|---------------------------------------------------|-----------|-----------------------------|-----------------------------------------+ 
           |                               | |             |   |                         |                         |           |                             |                                     |     
           |                               +-|-----------------+                         +-------------------------|-----------+                             +---------------+                 +---+     
           |                                 |             |                                                       |                                                         |                 |         
           +---------------------------------+             +-------------------------------------------------------+                                                         +-----------------+         
                                                                                                                                                                                                         ";

		static void Main(string[] args)
		{
			var mapLines = new List<string>();

			using (var reader = new StringReader(Map))
			{
				while (true)
				{
					string line = reader.ReadLine();

					if (line == null)
						break;

					mapLines.Add(line);
				}
			}

			var map = mapLines.ToArray();

			(int X, int Y) position = (map[0].IndexOf('|'), 0);
			(int DX, int DY) movementVector = (0, 1);

			void FollowTurn()
			{
				var candidates = new List<(int X, int Y)>();

				candidates.Add((position.X + 1, position.Y));
				candidates.Add((position.X - 1, position.Y));
				candidates.Add((position.X, position.Y + 1));
				candidates.Add((position.X, position.Y - 1));

				candidates.Remove((position.X - movementVector.DX, position.Y - movementVector.DY));

				var matches = new List<(int X, int Y)>();

				foreach (var candidate in candidates)
				{
					if ((candidate.Y < 0) || (candidate.Y >= map.Length))
						continue;
					if ((candidate.X < 0) || (candidate.X >= map[candidate.Y].Length))
						continue;

					if (map[candidate.Y][candidate.X] != ' ')
						matches.Add(candidate);
				}

				if (matches.Count > 1)
					throw new Exception("More than one possible direction at coordinate " + position);
				if (matches.Count == 0)
					throw new Exception("Got to " + position + " in direction " + movementVector + " and can't figure out where to go next");

				var match = matches.Single();

				movementVector = (match.X - position.X, match.Y - position.Y);
			}

			var path = new StringBuilder();

			while ((position.Y >= 0) && (position.Y < map.Length) && (position.X >= 0) && (position.X < map[position.Y].Length))
			{
				char mapCh = map[position.Y][position.X];

				if (mapCh == ' ')
					break;
				else if (mapCh == '+')
					FollowTurn();
				else if (char.IsLetter(mapCh))
					path.Append(mapCh);

				position.X += movementVector.DX;
				position.Y += movementVector.DY;
			}

			Console.WriteLine(path);
		}
	}
}
